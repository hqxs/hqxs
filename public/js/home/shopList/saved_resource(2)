/*!2017-06-14 09:12:28 merge: js/tools/common.storage.js,js/shop/shop.js,js/shop/view.js,js/shop/countdown.js,js/shop/vote.js,js/tools/common.emotion.js,js/tools/common.sync.js,js/comment/comment-new.js,js/shop/help.js!*/
;(function(win,undefined){var doc=document,nop=function(){},ie=/\bmsie\b/i.test(navigator.userAgent),flash=null,minFlashVer=6,isHttp=/^https?:$/.test(location.protocol),slice=Array.prototype.slice,root='http://www.haodou.com/',host=location.hostname,tf='function',ud='undefined',hd=win.hd||{},bind=function(elem,type,handler){if(elem.addEventListener){elem.addEventListener(type,handler,false)}else if(elem.attachEvent){elem.attachEvent('on'+type,function(){handler.apply(elem,arguments)})}return elem},ready=(function(){function ready(f){if(ready.done)return f();if(ready.timer){ready.ready.push(f)}else{bind(win,'load',isDOMReady);ready.ready=[f];ready.timer=setInterval(isDOMReady,13)}}function isDOMReady(){if(ready.done)return false;if(doc&&doc.getElementsByTagName&&doc.getElementById&&doc.body){clearInterval(ready.timer);ready.timer=null;for(var i=0;i<ready.ready.length;i++){ready.ready[i]()}ready.ready=null;ready.done=true}}return ready})(),flashDetect=function(){var np=navigator.plugins,f=false,v;if(np&&np.length){for(v=0,l=np.length;v<l;++v){if(np[v].name.indexOf('Shockwave Flash')>-1){f=parseInt(np[v].description.split('Shockwave Flash ')[1].split(' ')[0],10);break}}}else if(win.ActiveXObject){for(v=20;v>=6;--v){try{var fl=eval('new ActiveXObject("ShockwaveFlash.ShockwaveFlash.'+v+'");');if(fl){f=v;break}}catch(e){}}}return f},rPurge=new RegExp('[!\"#$%&\'()*+,/\\\\:;<=>?@[\\]^`{|}~.]','g');fixKey=function(k){return k.replace(rPurge,function(m){return('_0K_'+m.charCodeAt(0))})},revertKey=function(k){return k.replace(/_0K_(\d{2,3})/g,function(m,a,b){return String.fromCharCode(a)})},schemes={'localStorage':function(callback){var n='localStorage',f=(function(){try{return(n in win&&win[n])}catch(e){}return false})();if(f){var store=win.localStorage,k,t,api={engine:n,set:function(key,val){try{store.setItem(key,val)}catch(e){}},get:function(key){return store.getItem(key)},del:function(key){store.removeItem(key)},clear:function(){store.clear()},each:function(fn){if(typeof fn===tf){for(k in store){t=store.getItem(k);if(t){fn(k,t)}}}}};if(typeof callback===tf){callback.apply(api,slice.call(arguments,1))}return api}},'globalStorage':function(callback){var n='globalStorage',f=(function(){try{return(n in win&&win[n]&&win[n][host])}catch(e){}return false})();if(f){var store=win[n][host],k,t,api={engine:n,set:function(key,val){try{store[key]=val}catch(e){}},get:function(key){return(store[key]&&store[key].value)},del:function(key){delete store[key]},clear:function(){for(k in store){delete store[k]}},each:function(fn){if(typeof fn===tf){for(k in store){if(store.hasOwnProperty(k)){fn(k,store[k]&&store[k].value)}}}}};if(typeof callback===tf){callback.apply(api,slice.call(arguments,1))}return api}},'userData':function(callback){var f=(typeof doc.documentElement.addBehavior!==ud);if(f&&isHttp){var owner,conainer,store,db='userData';try{conainer=new ActiveXObject('htmlfile');conainer.open();conainer.write('<s'+'cript>document.w=window</s'+'cript><iframe src="/favicon.ico"></frame>');conainer.close();owner=conainer.w.frames[0].document;store=owner.createElement('div')}catch(e){flash=flashDetect();if(flash>=minFlashVer){return false}store=doc.createElement('link');store.style.display='none';owner=doc.body}if(owner){load()}else{ready(win,'load',function(){owner=doc.getElementsByTagName('head')[0];load()})}function load(){owner.appendChild(store);store.addBehavior('#default#userData')}function factory(fn){return function(){var args=slice.call(arguments,0);args.unshift(store);store.load(db);return fn.apply(win,args)}};var api={engine:db,set:factory(function(store,key,val){try{store.setAttribute(fixKey(key),val);store.save(db)}catch(e){}}),get:factory(function(store,key){return store.getAttribute(fixKey(key))}),del:factory(function(store,key){store.removeAttribute(fixKey(key));store.save(db)}),clear:factory(function(store){var attrs=store.XMLDocument.documentElement.attributes,len=attrs.length;while(--len>=0){store.removeAttribute(attrs[len].name)}store.save(db)}),each:factory(function(store,fn){if(typeof fn===tf){var attrs=store.XMLDocument.documentElement.attributes,l=attrs.length,i=0;for(;i<l;++i){fn(revertKey(attrs[i].name),attrs[i].value)}}})};if(typeof callback===tf){callback.apply(api,slice.call(arguments,1))}return api}},'sharedObject':function(callback){if(flash===null){flash=flashDetect()}if(flash>=minFlashVer){var swf=root+'public/swf/storage.swf',cid='clsid:D27CDB6E-AE6D-11CF-96B8-444553540000',args=arguments,timer=0,div=doc.createElement('div'),self=this,domain='*',ns='fcookie',pfx=ns+'_',name=ns+'_movie',debug=false;function load(){doc.body.appendChild(div)}if(doc.body){load()}else{ready(function(){load()})}try{if(typeof external!=ud&&typeof external.max_language_id!=ud){swf+='?v='+(+new Date())}}catch(e){}div.style.cssText='position:absolute;left:-9999px;top:-9999px;';if(ie){div.innerHTML='<object width="1" height="1" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+name+'" classid="'+cid+'">'+'<param value="'+swf+'" name="movie"><param value="always" name="allowScriptAccess">'+'<embed width="1" height="1" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" '+'allowscriptaccess="always" loop="false" play="true" name="'+name+'" src="'+swf+'"></object>'}else{var obj=doc.createElement('object'),param=doc.createElement('param'),embed=doc.createElement('embed');obj.setAttribute('width','1');obj.setAttribute('height','1');obj.setAttribute('id',name);obj.setAttribute('classid',cid);param.setAttribute('name','movie');param.setAttribute('value',swf);obj.appendChild(param);param=doc.createElement('param');param.setAttribute('name','allowscriptaccess');param.setAttribute('value','always');obj.appendChild(param);param=doc.createElement('param');param.setAttribute('name','wmode');param.setAttribute('value','transparent');obj.appendChild(param);embed.setAttribute('src',swf);embed.setAttribute('width',1);embed.setAttribute('height',1);embed.setAttribute('name',name);embed.setAttribute('allowscriptaccess','always');embed.setAttribute('type','application/x-shockwave-flash');obj.appendChild(embed);div.appendChild(obj)}var api={engine:'sharedObject',check:(function(){var fn=pfx+'check';return function(){if(typeof self.movie[fn]===tf){return self.movie[fn]()}return false}})(),set:(function(){var fn=pfx+'set';return function(key,val){if(typeof self.movie[fn]===tf){try{self.movie[fn](fixKey(key),[val])}catch(e){}}}})(),get:(function(){var fn=pfx+'get';return function(key){if(typeof self.movie[fn]===tf){var arr=self.movie[fn](fixKey(key));return(arr&&arr[0])?arr[0]:null}}})(),del:(function(){var fn=pfx+'del';return function(key){if(typeof self.movie[fn]===tf){self.movie[fn](fixKey(key))}}})(),clear:(function(){var fn=pfx+'del_all';return function(){if(typeof self.movie[fn]===tf){self.movie[fn]()}}})(),each:(function(){var fn=pfx+'get_all';return function(func){if(typeof func===tf&&typeof self.movie[fn]===tf){var db=self.movie[fn](),i;for(key in db){func(revertKey(key),db[key][0])}}}})()},init=function(){if(!self.movie){self.movie=ie?win[name]:doc[name]}if(!self.movie||typeof self.movie.init!==tf){if(++timer<10){setTimeout(init,100)}}else{self.movie.init(domain,debug,ns);if(typeof callback===tf){callback.apply(api,slice.call(args,1))}}};init();return api}}},apis=function(crossDomain,callback){var s=0,p=['localStorage','globalStorage','userData','sharedObject'],args=arguments,api,dapi={get:nop,set:nop,del:nop,clear:nop,each:nop};if(!!crossDomain&&isHttp){try{doc.domain='haodou.com';var ifm=doc.createElement('iframe');ifm.name='store';ifm.style.cssText='display:none;';bind(ifm,'load',function(){args[0]=false;var iwin=this.contentWindow.window,cache=iwin.cache,iapi=cache.apply(cache,args);for(var n in iapi){dapi[n]=(typeof iapi[n]!==tf)?iapi[n]:(function(fn){return function(){return fn.apply(iapi,arguments)}})(iapi[n])}});ifm.src=root+'public/js/cache.html';ready(function(){doc.body.appendChild(ifm)})}catch(e){}}else{for(args=slice.call(args,1);s<p.length;++s){api=schemes[p[s]].apply(this,args);if(api){return api}}}return dapi};hd.tools=hd.tools||{};hd.tools.storage=apis;win.hd=hd})(window);(function($){var shop_common={sideTop:function(){var $shop_side_top_li=$('#shop_side_top > li');$shop_side_top_li.mouseover(function(){$shop_side_top_li.removeClass('act');$(this).addClass('act')})},ajaxGetBrowse:function(){var $side_top_last_browse=$("#side_top_last_browse");if($side_top_last_browse.length>0){var storage=hd.tools.storage(),shop_goods_ids=storage.get('s_user_browse');if(shop_goods_ids){var arr_ids=shop_goods_ids.split(' ');$.getJSON("/ajax.php?do=browse",{'ids':arr_ids},function(json){var tpl='<h3>最新浏览</h3>'+'<ul class="sib_uid_list">'+'{li_tpl}'+'</ul>';li_tpl='<li>'+'<a title="{Title}" href="http://shop.haodou.com/view.php?id={ShopGoodsId}"><img alt="{Title}" src="{ImageUrl}"></a>'+'<div class="ohz">'+'<p><a title="{Title}" href="http://shop.haodou.com/view.php?id={ShopGoodsId}">{Title}</a></p>'+'<p>兑换价：<span class="orange">{SellPrice}豆币</span></p>'+'</div>'+'</li>';if(json){var tmp_tpl='';for(i in json){tmp_tpl+=li_tpl.replace(/\{\w+\}/g,function(m){return json[i][m.substring(1,m.length-1)]})}tpl=tpl.replace('{li_tpl}',tmp_tpl);$side_top_last_browse.html(tpl)}})}}}};shop_common.sideTop();shop_common.ajaxGetBrowse()})(jQuery);(function($){var tmp_tpl='<div class="public_elastic_layer">'+'<dl>'+'<dt class="f14 b"><a title="关闭" href="javascript://" onclick="hd.dialog.close();" class="ico20">&nbsp;</a>好豆网温馨提示：</dt>'+'<dd>'+'<p class="tc f14" id="lottery_info">Tmp_Info</p>'+'</dd>'+'<dd class="atn tc">'+'<a id="btn1" title="Tmp_Btn1" href="Tmp_Btn1_href" class="dbtn btn_green">Tmp_Btn1</a> '+'<a id="btn2" title="Tmp_Btn2" href="Tmp_Btn2_href" class="dbtn btn_green">Tmp_Btn2</a>'+'</dd>'+'</dl>'+'</div>';var goods={goodsTab:function(){$("#product_tab_title a").each(function(i){var $t=$(this);$t.click(function(){var $content=$(".product_tab_content");$("#product_tab_title a").removeClass("selx");$t.addClass("selx");$content.hide();if(i==0){$content.show()}else{$content.eq(i).show()}if(i==3){$(window).trigger('scroll.cmt')}})})},storageBrowse:function(){var shop_goods_id='',href=window.location.href,obj_match=href.match(/id=([0-9]+)/g);if(typeof obj_match=="object"&&obj_match){shop_goods_id=obj_match[0].replace('id=','')}if(shop_goods_id){var storage_shop_key='s_user_browse',storage=hd.tools.storage(),str_storage_data=storage.get(storage_shop_key);if(str_storage_data){var temp=' '+str_storage_data+' ';if(temp.indexOf(' '+shop_goods_id+' ')=='-1'){str_storage_data=shop_goods_id+' '+str_storage_data}else{str_storage_data=$.trim(temp.replace(' '+shop_goods_id+' ',' '));str_storage_data=str_storage_data?shop_goods_id+' '+str_storage_data:shop_goods_id}str_storage_data=$.trim(str_storage_data).split(" ").slice(0,10).join(' ');storage.set(storage_shop_key,str_storage_data)}else{storage.set(storage_shop_key,shop_goods_id)}}},buyNum:function(){var num=parseInt($("#buynum").val()),goodsstock=parseInt($('#goodsstock').text());function alertMsg(){if(num>goodsstock){num=goodsstock;$("#buynum").val(num);if(goodsstock==0)hd.dialog.alert("该礼品已兑完，您可以去看看其他礼品!");else hd.dialog.alert("该礼品库存仅"+goodsstock+"件，最多兑换"+goodsstock+"件!")}else{$("#buynum").val(num)}var sellprice=parseInt($('#sellprice').text());var totalprice=sellprice*num;$('#totalprice').text(totalprice)}$('#buynum').keyup(function(){var $t=$(this);$t.val($t.val().replace(/[^\d]/g,''));num=$t.val();if(num==''||num<=0){num=1;$t.val(num)}else{num=parseInt(num)}alertMsg()});$('#addnum').click(function(){num=num+1;alertMsg()});$('#delnum').click(function(){num=num-1;if(num<1)num=1;$("#buynum").val(num);alertMsg()})},buynow:function(){var buyflag=true;$('a[name="buynow"]').click(function(){if(!hd.login.isLogin()){hd.login.showLogin();return false}var goodsstock=parseInt($('#goodsstock').text());if(goodsstock>0){var idstr=$(this).attr("id");var id=parseInt(idstr.split("_")[1]);var num=$("#buynum").val();if(id&&buyflag){buyflag=false;$.ajax({type:"POST",url:'http://shop.haodou.com/ajax.php?do=buynow',data:({id:id,num:num}),dataType:'json',success:function(data){if(data.status==true){location.href="http://shop.haodou.com/order.php?id="+data.id+"&num="+data.num;buyflag=true;return false}else if(data.status==false){if(data.code==1){var html=tmp_tpl;html=html.replace(/Tmp_Info/g,data.info);html=html.replace(/Tmp_Btn1_href/g,"http://shop.haodou.com/all.php?b=my");html=html.replace(/Tmp_Btn1/g,"我能兑换的礼品");html=html.replace(/Tmp_Btn2_href/g,"http://shop.haodou.com/my.php?do=wealthrule");html=html.replace(/Tmp_Btn2/g,"快速赚取豆币秘笈");hd.dialog.popup('buynow',html,true)}else{hd.dialog.alert(data.info)}buyflag=true}},error:function(){buyflag=true}})}}else{hd.dialog.alert("该礼品已兑完，您可以去看看其他礼品!")}})},trygoods:function(){var trybuyflag=true;var trial_cookie=hd.tools.cookie("_trialgoods");if(trial_cookie){hd.tools.cookie("_trialgoods","")}$('a[name="trygoods"]').click(function(){if(!hd.login.isLogin()){hd.login.showLogin();return false}var goodsstock=parseInt($('#goodsstock').text());if(goodsstock>0){var idstr=$(this).attr("id");var id=parseInt(idstr.split("_")[1]);var isok=$('#trygoods:checked').val();if(id&&isok==1&&trybuyflag==true){trybuyflag=false;$.ajax({type:"POST",url:'http://shop.haodou.com/ajax.php?do=buynow',data:({id:id,num:1}),dataType:'json',success:function(data){if(data.status==true){location.href="http://shop.haodou.com/order.php?id="+id;buyflag=true;return false}else if(data.status==false){if(data.code==1){var html=tmp_tpl;html=html.replace(/Tmp_Info/g,data.info);html=html.replace(/Tmp_Btn1_href/g,"http://shop.haodou.com/all.php?b=my");html=html.replace(/Tmp_Btn1/g,"我能兑换的礼品");html=html.replace(/Tmp_Btn2_href/g,"http://shop.haodou.com/my.php?do=wealthrule");html=html.replace(/Tmp_Btn2/g,"快速赚取豆币秘笈");hd.dialog.popup('trybuynow',html,true)}else{hd.dialog.alert(data.info)}trybuyflag=true}},error:function(){buyflag=true}})}else{$('#trygoods_err').html('该项必选！')}}else{hd.dialog.alert("该礼品已兑完，您可以去看看其他礼品!")}})},lottery:function(){var lotteryflag=true;$('a[name="lottery"]').click(function(){if(!hd.login.isLogin()){hd.login.showLogin();return false}var str=$(this).attr("id");var id=parseInt(str.split("_")[1]);if(id&&lotteryflag==true){lotteryflag=false;$.ajax({type:"POST",url:'http://shop.haodou.com/ajax.php?do=lottery',data:({id:id}),dataType:'json',success:function(data){var html=tmp_tpl;if(data.code==1){hd.wealthTip();html=html.replace(/Tmp_Info/g,data.info);html=html.replace(/Tmp_Btn1_href/g,"http://shop.haodou.com/order.php?id="+id);html=html.replace(/Tmp_Btn1/g,"去确认收货地址");html=html.replace(/Tmp_Btn2_href/g,"");html=html.replace(/Tmp_Btn2/g,"");hd.dialog.popup('lottery_1',html,true,function(){},function(){$('#btn2').remove()});lotteryflag=true}else if(data.code==2){hd.dialog.alert(data.info);lotteryflag=true}else if(data.code==3){html=html.replace(/Tmp_Info/g,data.info);html=html.replace(/Tmp_Btn1_href/g,"http://shop.haodou.com/all.php?b=my");html=html.replace(/Tmp_Btn1/g,"我能兑换的礼品");html=html.replace(/Tmp_Btn2_href/g,"http://shop.haodou.com/my.php?do=wealthrule");html=html.replace(/Tmp_Btn2/g,"快速赚取豆币秘笈");hd.dialog.popup('lottery_3',html,true);lotteryflag=true}else if(data.code==4){hd.wealthTip();html=html.replace(/Tmp_Info/g,data.info);html=html.replace(/Tmp_Btn1_href/g,"javascript://");html=html.replace(/Tmp_Btn1/g,"再抽一次");html=html.replace(/Tmp_Btn2_href/g,"");html=html.replace(/Tmp_Btn2/g,"直接原价兑换");hd.dialog.popup('lottery_4',html,true,function(){$('#btn1').click(function(){hd.dialog.close();$("#goods_"+id).click()});var sourceurl=$('#sourceurl').attr("href");if(sourceurl&&sourceurl!='undefined'){$('#btn2').attr('href',sourceurl)}else{$('#btn2').remove()}},function(){$('#lottery_info').text(data.info)});lotteryflag=true}},error:function(){lotteryflag=true}})}})}};var roll={btn:$("#shop_roll .sp_ctrl > i"),min_container:$("#shop_roll .sp_shift > ul"),min_img:$("#shop_roll .sp_shift > ul > li"),min_img_width:90,max_img:$("#shop_roll .sp_bigims_ex img"),move:270,length:0,max:0,num:0,construct:function(){this.length=this.min_img.length;this.max=90*this.length-this.move;if(this.length>3)this.btn.last().addClass('rtix')},btnClick:function(t){var $t=$(t);if($t.index()==1&&$t.hasClass('rtix')){if(this.num+this.move>=this.max){this.num=this.max;$t.removeClass('rtix')}else{this.num+=this.move}this.go()}else if($t.index()==0&&$t.hasClass('ltix')){if(this.num-this.move<=0){this.num=0;$t.removeClass('ltix')}else{this.num-=this.move}this.go()}},go:function(){this.min_container.animate({"margin-left":(this.num*-1)+'px'},300);if(this.num>0)this.btn.first().addClass('ltix');if(this.num<this.max)this.btn.last().addClass('rtix')},minImgClick:function(t){var $t=$(t);this.min_img.removeClass('vt');$t.addClass('vt');this.max_img.attr('src',$t.find('img').attr('src').replace(/_80\.jpg/ig,"_350\.jpg"))}};$(function(){var order_page_flag=/^http:\/\/shop\.haodou\.com\/order\.php/.test(location.href);if(!order_page_flag){goods.goodsTab();goods.storageBrowse();goods.buynow();goods.trygoods();goods.lottery();roll.construct();roll.btn.click(function(){roll.btnClick(this)});roll.min_img.click(function(){roll.minImgClick(this)});roll.min_img.eq(0).click()}goods.buyNum()})})(jQuery);(function($){var fnTimeCountDown=function(d,o){var f={zero:function(n){var n=parseInt(n,10);if(n>0){if(n<=9){n="0"+n}return String(n)}else{return"00"}},dv:function(){d=d||Date.UTC(2050,0,1);var future=new Date(d),now=new Date();var dur=Math.round((future.getTime()-now.getTime())/1000)+future.getTimezoneOffset()*60,pms={sec:"00",mini:"00",hour:"00",day:"00",month:"00",year:"0"};if(dur>0){pms.sec=f.zero(dur%60);pms.mini=Math.floor((dur/60))>0?f.zero(Math.floor((dur/60))%60):"00";pms.hour=Math.floor((dur/3600))>0?f.zero(Math.floor((dur/3600))%24):"00";pms.day=Math.floor((dur/86400))>0?f.zero(Math.floor((dur/86400))):"00";pms.month=Math.floor((dur/2629744))>0?f.zero(Math.floor((dur/2629744))%12):"00";pms.year=Math.floor((dur/31556926))>0?Math.floor((dur/31556926)):"0"}return pms},ui:function(){if(o.sec){o.sec.innerHTML=f.dv().sec+'秒'}if(o.mini){o.mini.innerHTML=f.dv().mini+'分'}if(o.hour){o.hour.innerHTML=f.dv().hour+'时'}if(o.day){o.day.innerHTML=f.dv().day+'天'}if(o.month){o.month.innerHTML=f.dv().month+'月'}if(o.year){o.year.innerHTML=f.dv().year+'年'}setTimeout(f.ui,1000)}};f.ui()};$(function(){$(".count_time_down").each(function(i){var endtime=$(this).text();if(endtime&&endtime!='undefined'){endtime=endtime.split('-');var endyear=endtime[0];var endmonth=endtime[1]-1;var endday=endtime[2];var endhour=endtime[3];var endmin=endtime[4];fnTimeCountDown(Date.UTC(endyear,endmonth,endday,endhour,endmin),{sec:$(".count_time_second").get(i),mini:$(".count_time_minute").get(i),hour:$(".count_time_hour").get(i),day:$(".count_time_day").get(i)})}})})})(jQuery);(function($){$(function(){$('.gift_list li .vote').hover(function(){$(this).find('.vote_tips').show()},function(){$(this).find('.vote_tips').hide()});var voteflag=true;$('a[name="votegoods"]').click(function(){if(!hd.login.isLogin()){hd.login.showLogin();return false}if(voteflag==true){var str=$(this).attr('id').split("_");var pre=str[0];var id=parseInt(str[1]);if(str[2]=='vote'){hd.dialog.alert("抄底价礼品每人限投一票，您已经投过了！");return false}if(str[2]=='five'){hd.dialog.alert("该礼品已降至5折，亲，最低优惠了哦...");return false}if(id){voteflag=false;$.ajax({type:"POST",url:'http://shop.haodou.com/ajax.php?do=vote',data:({id:id}),dataType:'json',success:function(data){if(data.status==true){hd.dialog.alert(data.info);$('#'+pre+'_'+id).attr("id",pre+'_'+id+'_vote');if(pre=='list'){$("#votenum_"+id).text(data.vn)}if(pre=='list'||pre=='view'){$("#sellprice_"+id).text(data.sp)}}else if(data.status==false){hd.dialog.alert(data.info);if(data.code==1){$('#'+pre+'_'+id).attr("id",pre+'_'+id+'_vote')}if(data.code==2){$('#'+pre+'_'+id).attr("id",pre+'_'+id+'_five')}}voteflag=true},error:function(){voteflag=true}})}}})})})(jQuery);(function(hd){if(!hd||!hd.tools)return false;if(hd.tools.emotion)return true;var emotion={icons:{},instances:{},page_size:60,html_cache:{},counter:0,current:null,holder:null,loadIcons:function(iconGrp){var keys={};$.each(iconGrp.imgs,function(i,img){keys[img.i]=img.n});iconGrp.keys=keys;emotion.icons[iconGrp.id]=iconGrp},init:function(){var holder=$('<div id="__emotion_holder" style="display:none; position:absolute; z-index:20001"></div>');$("body").append(holder);holder.on('click','#memu_ul a',emotion.onChangeGroup).on('click','#smile_ul_li a',emotion.onClickEmotion).on('click','#e_next',emotion.onPageNext).on('click','#e_pre',emotion.onPagePrev).on('mouseenter','#smile_ul_li a',emotion.onEnterEmotion).on('mouseleave','#smile_ul_li a',emotion.onLeaveEmotion);$(document.body).click(function(event){if($(event.target).parents('#__emotion_holder').length==0){holder.hide()}return true});emotion.holder=holder},onChangeGroup:function(){if($(this.parentNode).hasClass("sel"))return false;emotion.current.opts.index=this.getAttribute('index');emotion.holder.html(emotion.getHtml(emotion.current.opts));return false},onClickEmotion:function(){var obj=emotion.current.target[0],str="{a:"+this.getAttribute("img-id")+"}";if('function'==typeof emotion.current.opts.callback)str='';if(document.selection){(obj.style.display!='none')&&obj.focus();var sel=document.selection.createRange();document.selection.empty();sel.text=str;sel.select()}else{var prefix,main,suffix;var newStart=obj.selectionStart+str.length;prefix=obj.value.substring(0,obj.selectionStart);main=obj.value.substring(obj.selectionStart,obj.selectionEnd);suffix=obj.value.substring(obj.selectionEnd);obj.value=prefix+str+suffix;obj.selectionStart=newStart;obj.selectionEnd=newStart}emotion.holder.hide();if('function'==typeof emotion.current.opts.callback){emotion.current.opts.callback({"holder":emotion.holder,"title":this.getAttribute("title"),"img":$(this).children("img").attr("src"),"id":this.getAttribute("group")+':'+this.getAttribute("img-id")})}(obj.style.display!='none')&&obj.focus();return false},onPageNext:function(){var opts=emotion.current.opts,now_page=parseInt($(this).prev().text().split("/")[0]),iconset=emotion.icons[opts.index],pages=Math.ceil(iconset.imgs.length/emotion.page_size);if(now_page>=pages)return false;opts.page++;emotion.holder.html(emotion.getHtml(opts));return false},onPagePrev:function(){var opts=emotion.current.opts,now_page=parseInt($(this).prev().text().split("/")[0]);if(now_page<2)return false;opts.page--;emotion.holder.html(emotion.getHtml(opts));return false},onEnterEmotion:function(){var a=$(this),img_id=a.attr("img-id"),group_id=a.attr("group"),title=a.attr("title"),holder=emotion.holder,img_src='http://img4.hoto.cn/public/images3/smile/'+emotion.icons[group_id].dir+'/'+img_id+'.gif',holder_left=parseInt(holder.offset().left),a_left=parseInt(a.offset().left),left=a_left-holder_left;if(left<=180){holder.find(".preview").html('<span><img src="'+img_src+'" alt="'+title+'"/></span><span class="name">'+title+'</span>').css({"left":"auto","right":"12px"}).show().find("img").width("60px")}else{holder.find(".preview").html('<span><img src="'+img_src+'" alt="'+title+'"/></span><span class="name">'+title+'</span>').css({"left":"12px","right":"0px"}).show().find("img").width("60px")}return false},onLeaveEmotion:function(){emotion.holder.find(".preview").children().remove().end().hide();return false},getHtml:function(opts){var iconset=emotion.icons[opts.index],pages=Math.ceil(iconset.imgs.length/emotion.page_size),cache_key=(opts.show_all_groups?'all':'a')+opts.index+'_'+opts.page;if(typeof emotion.html_cache[cache_key]!='undefined'){return emotion.html_cache[cache_key]}else{var html=['<div class="mod_emotion_panel">'];if(typeof opts.show_all_groups!="undefined"&&opts.show_all_groups){html.push('<div class="mod_emotion_hd"><ul id="memu_ul" class="clearfix">');for(var group_id in emotion.icons){var class_str=(group_id==opts.index)?'class="sel"':'';html.push('<li '+class_str+'><a href="javascript:;" index="'+group_id+'">'+emotion.icons[group_id].title+'</a></li>')}html.push('</ul></div>')}var bg_img=iconset.dir+'/'+opts.index+'_'+opts.page+'.gif?v=1';html.push('<div class="mod_emotion_bd"><div class="preview" style="display:none;"></div>','<ul id="smile_ul_li" class="default clearfix" style="background-image: url(http://img4.hoto.cn/public/images3/smile/'+bg_img+');">');var start=(opts.page-1)*emotion.page_size,end=Math.min(start+emotion.page_size,iconset.imgs.length);$.each(emotion.icons[opts.index].imgs.slice(start,end),function(i,img){html.push('<li><a img-id="'+img.i+'" group="'+iconset.id+'" title="'+img.n+'" href="javascript:;"></a></li>')});html.push('</ul></div>');if(pages>1){html.push('<div class="mod_emotion_page"><a id="e_pre" href="javascript:;" class="ui_mr5">上一页</a> <span class="page_info ui_mr5">'+opts.page+'/'+pages+'</span> <a id="e_next" href="javascript://" class="ui_mr5">下一页</a></div>')}html.push('</div>');emotion.html_cache[cache_key]=html.join('');return emotion.html_cache[cache_key]}},show:function(instance){var opts=instance.opts,holder=emotion.holder;holder.html(emotion.getHtml(opts));var offset=instance.eventer.offset();var height=instance.eventer.outerHeight();if(offset.top>314&&($(document).height()-offset.top-height)<314){holder.css({'top':offset.top-holder.outerHeight(),'left':offset.left})}else{holder.css({'top':offset.top+height,'left':offset.left})}holder.show()}};$(document).ready(function(){emotion.init()});emotion.loadIcons({'title':'默认','id':'a','dir':'60','imgs':[{i:'71',n:'捂嘴偷笑'},{i:'42',n:'奸笑'},{i:'58',n:'龇牙笑'},{i:'63',n:'龇牙笑'},{i:'66',n:'龇牙笑'},{i:'12',n:'发呆'},{i:'45',n:'无奈'},{i:'54',n:'无语'},{i:'55',n:'害羞'},{i:'60',n:'害羞'},{i:'40',n:'抠鼻'},{i:'37',n:'叹气'},{i:'35',n:'怒'},{i:'13',n:'紧张'},{i:'16',n:'惊吓'},{i:'10',n:'可怜'},{i:'51',n:'晕'},{i:'52',n:'烦躁'},{i:'9',n:'感动或哭'},{i:'38',n:'吐血'},{i:'28',n:'嘘'},{i:'21',n:'流口水'},{i:'69',n:'元芳'},{i:'65',n:'骑马舞'},{i:'39',n:'打酱油'},{i:'25',n:'浮云'},{i:'64',n:'hold住'},{i:'26',n:'潜水'},{i:'18',n:'给力'},{i:'46',n:'囧'},{i:'47',n:'囧'},{i:'48',n:'做鬼脸'},{i:'56',n:'做鬼脸'},{i:'4',n:'财迷'},{i:'17',n:'拖走'},{i:'19',n:'吐口水'},{i:'3',n:'切克闹'},{i:'70',n:'走你'},{i:'50',n:'顶'},{i:'11',n:'顶'},{i:'30',n:'小蜜蜂'},{i:'41',n:'石化'},{i:'31',n:'哥斯拉'},{i:'15',n:'光芒万丈'},{i:'22',n:'挖宝'}]});emotion.loadIcons({'title':'生活','id':'b','dir':'60','imgs':[{i:'67',n:'真牛'},{i:'53',n:'疑问'},{i:'2',n:'对不起'},{i:'61',n:'握手'},{i:'34',n:'再见'},{i:'14',n:'加油'},{i:'36',n:'谢谢'},{i:'1',n:'爱你'},{i:'20',n:'跑'},{i:'49',n:'灌水'},{i:'62',n:'甩头'},{i:'72',n:'抱抱'},{i:'73',n:'鼓掌'},{i:'74',n:'飞吻'},{i:'75',n:'啦啦队'},{i:'76',n:'蜡烛'},{i:'59',n:'啃玉米'},{i:'27',n:'鲜花'},{i:'7',n:'唱歌'},{i:'5',n:'跳舞'},{i:'6',n:'跳舞'},{i:'43',n:'感冒'},{i:'29',n:'吃东西'},{i:'8',n:'吃饭'},{i:'77',n:'吃饭'},{i:'78',n:'干杯'},{i:'79',n:'请吃鸡腿'},{i:'80',n:'送蛋糕'},{i:'23',n:'恭喜'},{i:'24',n:'放鞭炮'},{i:'57',n:'亲亲'}]});emotion.loadIcons({'title':'节日','id':'c','dir':'60','imgs':[{i:'32',n:'圣诞节'},{i:'33',n:'圣诞快乐'},{i:'44',n:'新年快乐'},{i:'68',n:'蛇年大吉'},{i:'81',n:'端午'},{i:'82',n:'马到成功'},{i:'83',n:'马上有福'},{i:'84',n:'马上有钱'}]});emotion.loadIcons({'title':'经典','id':'d','dir':'60','imgs':[{i:'85',n:'微笑'},{i:'86',n:'撇嘴'},{i:'87',n:'口水'},{i:'88',n:'呆'},{i:'89',n:'酷'},{i:'90',n:'流泪'},{i:'91',n:'害羞'},{i:'92',n:'鼓掌'},{i:'93',n:'无语'},{i:'94',n:'抓狂'},{i:'95',n:'吐'},{i:'96',n:'偷笑'},{i:'97',n:'闭嘴'},{i:'98',n:'伤心'},{i:'99',n:'发怒'},{i:'100',n:'调皮'},{i:'101',n:'委屈'},{i:'102',n:'白眼'},{i:'103',n:'惊讶'},{i:'104',n:'流汗'},{i:'105',n:'握手'},{i:'106',n:'晚安'},{i:'107',n:'睡'},{i:'108',n:'咖啡'},{i:'109',n:'呲牙'},{i:'110',n:'么么哒'},{i:'111',n:'玫瑰'},{i:'112',n:'米饭'},{i:'113',n:'啤酒'}]});hd.tools.emotion=function(eventer,holder,target,opts){if(typeof eventer=="string"){eventer=$('#'+eventer)}else if(typeof eventer=="object"&&eventer.getAttribute){eventer=$(eventer)}var eid=eventer.attr('__emotion_id')||emotion.counter++;if(typeof emotion.instances[eid]=="undefined"){opts=$.extend({'callback':false,'index':'a','page':1,'show_all_groups':true},opts||{});var newInstance={'eventer':eventer,'target':target,'opts':opts};emotion.instances[eid]=newInstance;eventer.attr('__emotion_id',eid)}var instance=emotion.instances[eid];emotion.show(instance);emotion.current=instance;return true};hd.tools.parse_emotion=function(str,size){var map={'5_138':'47','5_139':'44','5_140':'45','5_141':'55','5_142':'27','5_143':'48','5_144':'51','5_145':'54','5_146':'46','5_147':'50','5_148':'35','5_149':'53','5_150':'52','5_151':'49','5_152':'43','5_153':'37','5_154':'63','5_155':'62','5_156':'57','5_157':'61','5_158':'58','5_159':'56','5_160':'60','5_161':'59','5_100':'18','5_101':'19','5_102':'20','5_103':'25','5_104':'22','5_105':'26','5_106':'21','5_107':'23','5_108':'24','5_109':'31','5_110':'42','5_111':'38','5_112':'29','5_113':'30','5_114':'32','5_115':'28','5_116':'33','5_117':'39','5_118':'36','5_119':'34','5_120':'41','5_121':'40','5_122':'9','5_127':'4','5_128':'3','5_130':'5','5_131':'1','5_132':'6','5_133':'2','5_135':'8','5_137':'7','5_88':'10','5_89':'11','5_91':'12','5_92':'13','5_93':'14','5_97':'15','5_95':'16','5_98':'17'};size=size||'30';return str.replace(/\{([a-z]+):([\d]+)\}/g,function(){var group_id=arguments[1],img_id=arguments[2];if(img_id>0&&img_id<300){return'<img class="icon" src="http://img4.hoto.cn/public/images3/smile/60/'+img_id+'.gif"  height="'+size+'" />'}return arguments[0]}).replace(/\{:(\d+):\}/g,function(){var img_id=arguments[1];for(var index in emotion.icons){if(emotion.icons[index].keys[img_id]){var img_title=emotion.icons[index].keys[img_id];return'<img class="icon" alt="'+img_title+'" src="http://img4.hoto.cn/public/images3/smile/60/'+img_id+'.gif" height="'+size+'" />'}}}).replace(/\{:(\d+_\d+):\}/g,function(){var key=arguments[1];return map[key]?'<img class="icon" src="http://img4.hoto.cn/public/images3/smile/60/'+map[key]+'.gif" height="'+size+'" />':arguments[0]})};hd.tools.peverse_emotion=function(str){return str.replace(/(<img\s+[^>]*src="http:\/\/img4\.hoto\.cn\/public\/images3\/smile\/\d+\/(\d+)\.gif"[^>]*>)/g,function(){var img_html=arguments[1],img_id=arguments[2];return'{a:'+img_id+'}'})}})(hd);(function(){if(hd){hd.tools.sync={},hd.tools.sync.cache=null;var lock_flag=false,_obj_arr=[];hd.tools.sync.spread=function($div_obj,opt){var sync_weibo_class={"qq":{"on":"sc_qqvbo","off":"no_qqvbo"},"sina":{"on":"sc_sina","off":"no_sina"}},sync_num_str={1:"163",2:"qq",3:"sina",4:"douban",5:"sohu"},sync_str_num={"163":1,"qq":2,"sina":3,"douban":4,"sohu":5},produceDiv=function(data,$sync_obj){if(data.code==1){var tips="";if(hd.tools.cookie("_sync_tips")!='-1'){}var sync_html='<span class="mod_syncx"><label class="fl">同步到：</label>WEIBOLIST'+tips+'</span>',show_sync=[];for(var key in opt){var num=sync_str_num[opt[key]];if(num==6||opt[key]=='qzone'){continue}if(data.syncs[num]&&data.syncs[num]['Has']==1){show_sync.push('<a class="ico20 im '+sync_weibo_class[opt[key]].on+'" openflag="1" href="javascript://" siteid="'+num+'"></a>')}else{show_sync.push('<a class="ico20 im '+sync_weibo_class[opt[key]].off+'" href="http://wo.haodou.com/settings.php?do=sync" target="_blank" siteid="'+num+'"></a>')}}sync_html=sync_html.replace(/WEIBOLIST/g,show_sync.join(""));$sync_obj.html(sync_html).find(".im[openflag=1]").click(function(){var class_name=$(this).attr('class'),siteid=$(this).attr('siteid');if(/sc_/.test(class_name)){$(this).addClass(sync_weibo_class[sync_num_str[siteid]].off).removeClass(sync_weibo_class[sync_num_str[siteid]].on)}else{$(this).addClass(sync_weibo_class[sync_num_str[siteid]].on).removeClass(sync_weibo_class[sync_num_str[siteid]].off)}var sync_sites_str=$sync_obj.find("[openflag=1]").map(function(){if(($(this).attr('class')).indexOf("sc_")==-1)return $(this).attr('siteid')}).get().join(",");hd.tools.cookie("share_weibo_nums",sync_sites_str,43200)});var nums_str=hd.tools.cookie("share_weibo_nums");if(nums_str){nums_arr=nums_str.split(",");for(var i=0;i<nums_arr.length;i++){var single_sync=$sync_obj.find(".im[siteid="+nums_arr[i]+"]"),_class_obj=sync_weibo_class[sync_num_str[nums_arr[i]]];single_sync.removeClass(_class_obj.on).addClass(_class_obj.off)}}hd.tools.sync.cache=data}};if(!$div_obj&&$div_obj.size()<1){return false}if(typeof opt=="undefined"){var opt=["qq","qzone","sina"]}if(!hd.tools.sync.cache){if(lock_flag){_obj_arr.push($div_obj);return false}lock_flag=true;var callback=function(data){produceDiv(data,$div_obj);_obj_arr_len=_obj_arr.length;if(_obj_arr_len>0){for(var i=0;i<_obj_arr_len;i++){produceDiv(data,_obj_arr[i])}_obj_arr=[]}lock_flag=false};if(location.host=="www.haodou.com"){$.get(hd.base.root+"user/sync.php?do=getUserSyncInfo",{},callback,"json")}else{$.ajax({"url":hd.base.root+"user/sync.php?do=getUserSyncInfo","type":"GET","dataType":"jsonp","success":callback})}}else{produceDiv(hd.tools.sync.cache,$div_obj)}},hd.tools.sync.achieve=function($div_obj){if(!$div_obj){return false}var sync_sites_str=$div_obj.find(".im[openflag=1]").map(function(){if(/sc_/.test($(this).attr('class')))return $(this).attr('siteid')}).get().join(",");return sync_sites_str}}})(jQuery);(function($,hd){var BACKEND='http://www.haodou.com/comment.php';var tpl_v3={cmt_item:'<div class="cmt_item" id="__cmt_{CommentId}">'+'	<div class="photo"><a target="_blank" title="" href="{OpenUserHome}"><img width="70" height="70" alt="" src="{OpenUserAvatar}"></a></div>'+'    <div class="cmt_main">'+'    	<span class="ico20 corner_bg">&nbsp;</span>'+'    	<p class="user_attr">'+'        	 <a href="javascript://" class="__cmt_reply_del  {Admin}">删除</a><span class="gray9">&nbsp;&nbsp;</span>'+'            <a class="mgr10" target="_blank" title="" href="{OpenUserHome}">{OpenUserName}</a>{Vip}{Level}{LastAct}'+'        </p>'+'        <p class="user_attr gray9"><a title="" class="fr" href="javascript:///" item="{CommentId}"><span class="__cmt_reply_btn">回复</span></a><span class="mgr10">发表于{CreateTime}</span><span>来自<a href="{PlatformUrl}" target="_blank">{Platform}</a><a href="{OpenUserHome}" target="_blank" class="{SynIco}"></a></span></p>'+'        <p class="is_info cmt_content">{Content}</p>'+'        <div class="sub_cmt" style="display:none">'+'        	<ul class="img_txt clearfix"></ul>'+'        </div>'+'    </div>'+'</div>',cmt_item_sub:'<li id="__cmt_{CommentId}">'+'    <a class="img" target="_blank" title="" href="{OpenUserHome}"><img width="22" height="22" alt="" src="{OpenUserAvatar}" /></a>'+'    <div class="txt">'+'        <p class="user_attr">'+'        	 <span class="fr"><a href="javascript://" class="__cmt_reply_del  {Admin}">删除</a><span class="gray9">&nbsp;&nbsp;</span><a title="" href="javascript:///" item="{CommentId}"><span class="__cmt_reply_btn">回复</span></a></span>'+'            <a class="mgr10" target="_blank" title="" href="{OpenUserHome}">{OpenUserName}</a>{Vip}{Level}'+'        </p>'+'        <p class="gray9"><span class="mgr10">发表于{CreateTime}</span><span>来自<a href="{PlatformUrl}" target="_blank">{Platform}</a><a href="{OpenUserHome}" target="_blank" class="{SynIco}"></a></span></p>'+'        <p class="cmt_content">{Content}</p>'+'     </div>'+'</li>',reply_box:'<div class="write clearfix">'+'    <div class="cmt_main clearfix">'+'        <textarea class="fl gray9 mgb10 big_sub" rows="" id="__cmt_content_reply" cols=""></textarea>'+'        <div style="position:relative;" class="clearfix cb mgt5 pdb5">'+'            <input type="submit" value="回复" id="__cmt_reply_comment" class="dbtn btn_green re_dbtn">'+'            <div class="fl">'+'                <a href="javascript:///" id="__cmt_face_reply" class="area_face"><img alt="" src="http://www.haodou.com/public/images/recipe/temp-14.gif"></a>'+'            </div>'+'            <div class="syn fl" id="_cmt_syn_reply"></div>'+'        </div>'+'    </div>'+'</div>',reply_box_sub:'<div class="write clearfix">'+'    <div class="cmt_main clearfix">'+'        <textarea class="fl gray9 is_sub" rows="" id="__cmt_content_reply" cols=""></textarea>'+'        <div style="position:relative;" class="clearfix cb pdt5">'+'            <input type="submit" value="回复" id="__cmt_reply_comment" class="sbtn btn_green fr">'+'            <div class="fl">'+'                <a href="javascript:///" id="__cmt_face_reply" class="area_face"><img alt="" src="http://www.haodou.com/public/images/recipe/temp-14.gif"></a>'+'            </div>'+'            <div class="syn fl" id="_cmt_syn_reply"></div>'+'        </div>'+'    </div>'+'</div>',comment_box:'<div class="mod_comment">'+'	<div class="pub_cmt_title">'+'    	<h2>'+'        	全部评论<span class="n font12" id="__cmt_count">(0条)</span>'+'        	<i class="lt"></i>'+'        	<i class="rt"></i>'+'    	</h2>'+'	</div>'+'	<div class="write clearfix mgt20 mgb20">'+'    	<div class="photo">'+'        	<a href="javascript:///" title=""><img width="70" height="70" id="__cmt_avatar" alt="" src="http://avatar1.hoto.cn/47/76/48901_48.jpg"></a>'+'    	</div>'+'    	<div class="cmt_main clearfix">'+'        	<div class="aera_up clearfix fl">'+'           	<div class="fl"><a href="javascript:///" id="__cmt_face_comment" class="area_face vtl"><img src="http://www.haodou.com/public/images/recipe/temp-14.gif"></a></div>'+'            	<div class="syn fr mgt5" id="_cmt_syn_comment" style="width:auto"></div>'+'        	</div>'+'        	<textarea class="fl gray9" rows="" cols="" id="__cmt_content_comment"></textarea>'+'        	<div style="position:relative;" class="clearfix cb pdt5">'+'            	<input type="submit" value="发布" id="__cmt_post_comment" class="dbtn btn_green fr">'+'        	</div>'+'    	</div>'+'	</div>'+'</div>'},tpl_v2={cmt_item:'<div class="cmt_item" id="__cmt_{CommentId}">'+'	<div class="photo"><a target="_blank" title="" href="{OpenUserHome}"><img width="48" alt="" src="{OpenUserAvatar}"></a></div>'+'    <div class="cmt_main">'+'    	<p class="user_attr">'+'        	 <span class="fr"><a href="javascript://" class="__cmt_reply_del  {Admin}">删除</a><span class="gray9">&nbsp;&nbsp;</span><a title="" href="javascript:///" item="{CommentId}"><span class="__cmt_reply_btn">回复</span></a></span>'+'            <a class="mgr10" target="_blank" title="" href="{OpenUserHome}">{OpenUserName}</a>{Vip}{Level}{LastAct}'+'        </p>'+'        <p class="gray9 mgb10"><span class="mgr10">发表于{CreateTime}</span><span>来自<a href="{PlatformUrl}" target="_blank">{Platform}</a><a href="{OpenUserHome}" target="_blank" class="{SynIco}"></a></span></p>'+'        <p class="mgb10 cmt_content">{Content}</p>'+'        <div class="sub_cmt" style="display:none">'+'        	<ul class="img_txt clearfix"></ul>'+'        </div>'+'    </div>'+'</div>',cmt_item_sub:'<li id="__cmt_{CommentId}">'+'	<a class="img" target="_blank" title="" href="{OpenUserHome}"><img  width="22" alt="" src="{OpenUserAvatar}" /></a>'+'    <div class="txt">'+'    	<p class="user_attr">'+'        	 <span class="fr"><a href="javascript://" class="__cmt_reply_del  {Admin}">删除</a><span class="gray9">&nbsp;&nbsp;</span><a title="" href="javascript:///" item="{CommentId}"><span class="__cmt_reply_btn">回复</span></a></span>'+'            <a class="mgr10" target="_blank" title="" href="{OpenUserHome}">{OpenUserName}</a>{Vip}{Level}'+'        </p>'+'        <p class="gray9"><span class="mgr10">发表于{CreateTime}</span><span>来自<a href="{PlatformUrl}" target="_blank">{Platform}</a><a href="{OpenUserHome}" target="_blank" class="{SynIco}"></a></span></p>'+'        <p class="cmt_content">{Content}</p>'+'     </div>'+'</li>',reply_box:'<div class="write clearfix">'+'    <div class="cmt_main clearfix">'+'        <textarea class="fl gray9" rows="" id="__cmt_content_reply" cols=""></textarea>'+'        <div style="position:relative;" class="clearfix cb">'+'            <input type="submit" value="回复" id="__cmt_reply_comment" class="btn_60 fr">'+'            <div class="fl mgr10">'+'                <div id="__cmt_face_show_reply" style="display:none;"></div><a href="javascript:///" id="__cmt_face_reply" class="area_face"><img alt="" src="http://www.haodou.com/public/images/recipe/temp-14.gif"></a>'+'            </div>'+'            <div class="syn fl" id="_cmt_syn_reply"></div>'+'        </div>'+'    </div>'+'</div>',comment_box:'<div class="mod_comment">'+'	<div class="pub_cmt_title">'+'    	<h2>'+'        	全部评论<span class="n font12" id="__cmt_count">(0条)</span>'+'        	<i class="lt"></i>'+'        	<i class="rt"></i>'+'    	</h2>'+'	</div>'+'	<div class="write clearfix mgt20 mgb20">'+'    	<div class="photo">'+'        	<a href="javascript:///" title=""><img width="48" id="__cmt_avatar" alt="" src="http://avatar1.hoto.cn/47/76/48901_48.jpg"></a>'+'    	</div>'+'    	<div class="cmt_main clearfix">'+'        	<div class="aera_up clearfix fl">'+'           	<div class="fl"><div id="__cmt_face_show_comment" style="display:none;"></div><a href="javascript:///" id="__cmt_face_comment" class="area_face"><img src="http://www.haodou.com/public/images/recipe/temp-14.gif"></a></div>'+'            	<div class="syn fr" id="_cmt_syn_comment"></div>'+'        	</div>'+'        	<textarea class="fl gray9" rows="" cols="" id="__cmt_content_comment"></textarea>'+'        	<div style="position:relative;" class="clearfix cb">'+'            	<input type="submit" value="发布" id="__cmt_post_comment" class="btn_60 fr">'+'        	</div>'+'			<div class="cmt_face_show" id="__cmt_face_show_comment" style="display:none"></div>'+'    	</div>'+'	</div>'+'</div>'};var tpl,self,element,handler={};handler.onClickCommentEmotion=function(){hd.tools.emotion('__cmt_face_reply',element.find('#__cmt_face_show_reply'),element.find('#__cmt_content_reply'));return false};handler.onClickReplyEmotion=function(){hd.tools.emotion('__cmt_face_comment',element.find('#__cmt_face_show_comment'),element.find('#__cmt_content_comment'));return false};handler.onClickComment=function(){if(!hd.login.isLogin()){hd.login.showLogin(function(data){if(data.status){location.hash='comment';location.reload()}else{$('#login_msg').html('<i class="ico20 ico_warning">&nbsp;</i>'+data.msg).css('visibility','visible')}});return false}var $this=$(this),type=($this.attr('id')=='__cmt_reply_comment')?'reply':'comment',content=$.trim(element.find('#__cmt_content_'+type).val());if(content==''){hd.dialog.alert('亲，评论内容不可以为空哦~');return false}var post_data={channel:self.channel,item:self.item_id,content:content,syn:hd.tools.sync.achieve(element.find('#_cmt_syn_'+type)),reply_id:self.reply_id,special_cover:(self.channel=='special'&&self.reply_id==0)?element.data('special_cover'):''};if($(this.parentNode).find('#loading #delupload').length){post_data.nofeed='1'}self.post(post_data,handler.onPosted);return false};handler.onPosted=function(data){var cmt=data['data'];if(cmt['ReplyId']=='0'){var $button=element.find('#__cmt_post_comment'),$textarea=element.find('#__cmt_content_comment'),html=tpl.cmt_item}else{var $item=element.find('#__cmt_'+cmt['ReplyId']),$button=$item.find('#__cmt_reply_comment'),$textarea=$item.find('#__cmt_content_reply'),html=tpl.cmt_item_sub}$button.prop('disabled',false);if(data['status']!='200'){hd.dialog.alert(data.message);return false}html=html.replace(/\{([a-z0-9_]+)\}/ig,function(tag,field){return(typeof(cmt[field])=='undefined')?tag:cmt[field]});html=hd.tools.parse_emotion(html);if(cmt['ReplyId']=='0'){$button.parents('.write').after(html);self.count++;element.find('#__cmt_count').html('('+self.count+'条)')}else{$item.find('.sub_cmt').show();if($item.find('.img_txt').length>0){$item.find('.img_txt').prepend(html)}else{$item.prepend(html)}$textarea.parent().parent().hide()}$textarea.val('');self.fire('postSuccess',cmt);hd.wealthTip();return false};handler.onClickReply=function(){var $this=$(this),$write=$this.parents('p').siblings('.write');if($write.get(0)&&$write.get(0).className=='write clearfix'){$write.toggle();$write.find('#__cmt_content_reply').focus()}else{var box=(self.reply_id>0)?element.find('#__cmt_'+self.reply_id).find('.write'):false;if(!box||box.length==0){box=element.find('#__cmt_reply_box').children()}if(tpl.reply_box_sub){if($this.parents('.sub_cmt').length>0){box.find('textarea').attr('class','fl gray9 is_sub').next('div').attr('class','clearfix cb pdt5').children('input').attr('class','sbtn btn_green fr')}else{var cls=($this.parents('p.user_attr').siblings('.sub_cmt').css('display')=='none')?'clearfix cb mgt5 pdb5':'clearfix cb mgt5 pdb20';box.find('textarea').attr('class','fl gray9 mgb10 big_sub').next('div').attr('class',cls).children('input').attr('class','dbtn btn_green re_dbtn')}}box.show();$this.parents('p').siblings('.cmt_content').after(box);box.find('#__cmt_content_reply').focus()}self.reply_id=parseInt($this.parent().attr('item'));return false};handler.onClickTextArea=function(){if(!hd.login.isLogin()){hd.login.showLogin(function(data){if(data.status){location.hash='comment';location.reload()}else{$('#login_msg').html('<i class="ico20 ico_warning">&nbsp;</i>'+data.msg).css('visibility','visible')}});return false}if($(this).attr('id')=='__cmt_content_comment'){self.reply_id=self.comment_id}return false};handler.renderList=function(data){if(data['status']!='200'){hd.dialog.alert(data['message']);return false}data=data['data'];self.count=parseInt(data['total']);if(self.comment_id>0){self.count--}element.find('#__cmt_count').html('('+self.count+'条)');if(data['avatar'].length>0){element.find('#__cmt_avatar').attr('src',data['avatar'])}if(data['total']!=0){if(self.reply_id){element.find('#__cmt_reply_box').prepend(element.find('#__cmt_'+self.reply_id).find('.write'));self.reply_id=0}element.find('.cmt_item').remove();var sub_cmts=[];for(var i in data['data']){var cmt_tmp=tpl.cmt_item;for(var m in data['data'][i]){if(m=='SubCommentCnt'&&data['data'][i][m]>0){cmt_tmp=cmt_tmp.replace('<span class="__cmt_reply_btn">回复</span>','<span class="__cmt_reply_btn">回复('+data['data'][i][m]+')</span>')}cmt_tmp=cmt_tmp.replace(new RegExp('{'+m+'}',"g"),data['data'][i][m])}cmt_tmp=hd.tools.parse_emotion(cmt_tmp);cmt_tmp=cmt_tmp.replace(new RegExp('<img src="',"g"),'<img width="100" onload="__cmt_fiximg(this);" src="');if(data['data'][i]['ReplyId']=='0'){element.find('.mod_comment').append(cmt_tmp)}else{sub_cmts.push(data['data'][i])}}for(var i in sub_cmts){var cmt_tmp=tpl.cmt_item_sub;for(var m in sub_cmts[i]){cmt_tmp=cmt_tmp.replace(new RegExp('{'+m+'}',"g"),sub_cmts[i][m])}cmt_tmp=hd.tools.parse_emotion(cmt_tmp);cmt_tmp=cmt_tmp.replace(new RegExp('<img src="',"g"),'<img width="100" onload="__cmt_fiximg(this);" src="');element.find('#__cmt_'+sub_cmts[i]['ReplyId']).find('.sub_cmt').show();element.find('#__cmt_'+sub_cmts[i]['ReplyId']).find('.img_txt').append(cmt_tmp)}if(self.comment_id){$('#__cmt_'+self.comment_id).find('.photo').html('&nbsp;');$('#__cmt_'+self.comment_id).find('.cmt_main').children('p').remove()}else{element.find('#__cmt_page_nav').remove();element.find('.mod_comment').append('<div id="__cmt_page_nav" class="bd_page">'+data['page_nav']+'</div>')}}if(!$.browser.msie&&!$.browser.mozilla){element.find('.mod_comment').prepend(element.find('.mod_comment').children('.pub_cmt_title, .write'))}self.fire('pageLoaded',data['data'])};handler.onClickDelete=function(){var $this=$(this),id=$this.parents('li').attr('id'),cid=id||$this.parents('.cmt_item').attr('id'),dom=(cid!=id)?$this.parents('.cmt_item'):$this.parents('li');cid=cid.split('__cmt_')[1];self.remove(cid,function(data){if(data['status']!='200'){hd.dialog.alert(data['message']);return false}dom.remove();self.count--;element.find('#__cmt_count').html('('+self.count+'条)');return false})};handler.onClickPager=function(){$(window).scrollTop(element.find('.mod_comment').offset().top-(hd.base.ie6?10:60));self.load($(this).attr('page'),handler.renderList);return false};var util={};util.restore=function(lite,content){var full={};full.UserId=lite.uid;full.ItemId=lite.id;full.Content=content.replace(/<[^>]*>/g,'');if(lite.au){full.AtUserId=lite.au[0];full.Content='@<a href="http://wo.haodou.com/'+lite.au[0]+'/" target="_blank">'+lite.au[1]+'</a> '+full.Content}else{full.AtUserId=null}full.Type=lite.t;full.Platform='好豆网';full.PlatformUrl='http://www.haodou.com/';full.CreateTime=lite.ct;full.Status=lite.s;full.ReplyId=lite.r;full.CommentId=lite.cid;full.CommentCnt=lite.cc;full.Vip='';if(lite.v){full.Vip='<a href="http://www.haodou.com/recipe/expert/apply" target="_blank"><i class="ico12 mod_v"></i></a> '}full.OpenUserName=lite.un;full.OpenUserHome='http://wo.haodou.com/'+lite.uid+'/';full.OpenUserAvatar=lite.ua;full.Level='<span class="gray6 mgr10"><span class="ico32 mod_level_'+lite.l[0]+'"></span> '+lite.l[1]+'</span>';full.LastAct=lite.a||'';full.Admin=lite.m;return full};function CommentWidget($elem){var params=$elem.data();this.pagesize=params.pagesize||12;this.comment_id=params.comment_id||0;this.item_id=params.item_id;this.channel=params.channel;this.version=params.version||'3';this.sort=params.sort||'desc';this.count=0;this.purify=params.purify||'common';this.callbacks={};var match=window.location.hash.match(/^#?comment_(\d+)$/);this.offset=match?match[1]:0;this.element=$elem}CommentWidget.prototype.init=function(){tpl=(this.version=='3')?tpl_v3:tpl_v2;element=this.element;self=this;element.html(tpl.comment_box).append('<div id="__cmt_reply_box" style="display:none">'+tpl.reply_box+'</div>');this.fire('loaded',tpl);element.find('#__cmt_face_reply').click(handler.onClickCommentEmotion);element.find('#__cmt_face_comment').click(handler.onClickReplyEmotion);element.on('click.comment','#__cmt_post_comment,#__cmt_reply_comment',handler.onClickComment);element.on('click.reply','.__cmt_reply_btn',handler.onClickReply);element.on('click.textarea','#__cmt_content_reply, #__cmt_content_comment',handler.onClickTextArea);hd.tools.sync.spread(element.find('#_cmt_syn_comment'));hd.tools.sync.spread(element.find('#_cmt_syn_reply'));element.on('click.del','.__cmt_reply_del',handler.onClickDelete);element.on('click.page','#__cmt_page_nav a',handler.onClickPager);var $win=$(window),$mod=element.find('.mod_comment'),offset=this.offset,loadComment=function(callback){if(offset>0){self.loadOffset(offset,function(data){handler.renderList(data);callback&&callback(data)})}else{self.load(1,handler.renderList)}};if($win[0].location.hash.match(/^#?comment/)){loadComment(offset>0?function(resp){if(resp.status!=200){return false}var $cmt=$('#__cmt_'+resp['data'].offset);$cmt.length&&window.setTimeout(function(){window.scroll(0,$cmt.offset().top-38)},100)}:false)}else{$win.bind('scroll.cmt',function(){if(($win.height()+$win.scrollTop())>=$mod.offset().top){$win.unbind('.cmt');loadComment(false)}}).bind('resize.cmt',function(){$win.trigger('scroll.cmt')})}};CommentWidget.prototype.load=function(page,callback){var params={channel:this.channel,item:this.item_id,sort:this.sort,page:page,size:this.pagesize,comment_id:this.comment_id,cate:0,purify:this.purify},url=BACKEND+'?do=list&callback=?';$.getJSON(url,params,callback)};CommentWidget.prototype.loadOffset=function(offset,callback){var params={channel:this.channel,item:this.item_id,sort:this.sort,offset:offset,size:this.pagesize,comment_id:this.comment_id,cate:0,purify:this.purify},url=BACKEND+'?do=list&callback=?';$.getJSON(url,params,callback)};CommentWidget.prototype.on=function(evt,callback){this.callbacks[evt]=callback;return this};CommentWidget.prototype.fire=function(){var evt=Array.prototype.shift.apply(arguments);this.callbacks[evt]&&this.callbacks[evt].apply(null,arguments)};CommentWidget.prototype.post=function(post_data,callback){var url=BACKEND+'?do=post';hd.cross.post(url,post_data,function(data){if(data.status==200&&location.host!='www.haodou.com'){data['data']=util.restore(data['data'],post_data.content)}callback(data)})};CommentWidget.prototype.remove=function(comment_id,callback){var params={channel:this.channel,item:this.item_id,cmt_id:comment_id,cate:0};hd.cross.get(BACKEND,params,callback)};var $elem=$('#hd-comment');if($elem.length){var cmt=new CommentWidget($elem);cmt.init()}window.CommentWidget=CommentWidget})($,hd);function __cmt_fiximg(img){var img_tmp=new Image();img_tmp.src=img.src;img.width=(img_tmp.width>580)?580:img_tmp.width;img_tmp=null};(function($){var help={show:function(){var gethelp=$('<div class="online_service" style="top:180px;right:10px;">'+'<p class="tr"><a title="关闭" href="javascript://" class="ico20 close">&nbsp;</a></p>'+'<p class="tc mgt5"><img alt="好豆客服" src="http://www.haodou.com/public/images/public/service_ol.jpg"></p>'+'<p class="mgt5 gray6 tc">欢迎来到好豆！<br>有任何问题都可以咨询我哦！</p>'+'<p class="mgt5 tc"><a class="dbtn btn_green" onclick="javascript:window.open(\'http://b.qq.com/webc.htm?new=0&amp;sid=800077728&amp;eid=2188z8p8p8p8y8y8y8K8z&amp;o=www.haodou.com&amp;q=7\', \'_blank\', \'height=544, width=644,toolbar=no,scrollbars=no,menubar=no,status=no\');" href="javascript://" title="在线咨询">在线咨询</a></p>'+'</div>');var css={'position':'fixed'};if($.browser.version=='6.0'){css.position='absolute';$(window).scroll(function(){gethelp.css({'top':$(document).scrollTop()+180})})}gethelp.css(css);$("body").append(gethelp);gethelp.find('a.close').click(function(){$('.online_service').hide()});$(window).trigger("scroll")}};$(function(){})})(jQuery);