/*!2017-06-08 10:15:09 merge: js/shop/login.js,js/shop/help.js,js/shop/countdown.js,js/shop/favorite.js,js/tools/common.waterfall.js,js/shop/waterfall.js,js/shop/index.js!*/
;(function($){$("#shop_login_btn").click(function(){if(!hd.login.isLogin())hd.login.showLogin()})})(jQuery);(function($){var help={show:function(){var gethelp=$('<div class="online_service" style="top:180px;right:10px;">'+'<p class="tr"><a title="关闭" href="javascript://" class="ico20 close">&nbsp;</a></p>'+'<p class="tc mgt5"><img alt="好豆客服" src="http://www.haodou.com/public/images/public/service_ol.jpg"></p>'+'<p class="mgt5 gray6 tc">欢迎来到好豆！<br>有任何问题都可以咨询我哦！</p>'+'<p class="mgt5 tc"><a class="dbtn btn_green" onclick="javascript:window.open(\'http://b.qq.com/webc.htm?new=0&amp;sid=800077728&amp;eid=2188z8p8p8p8y8y8y8K8z&amp;o=www.haodou.com&amp;q=7\', \'_blank\', \'height=544, width=644,toolbar=no,scrollbars=no,menubar=no,status=no\');" href="javascript://" title="在线咨询">在线咨询</a></p>'+'</div>');var css={'position':'fixed'};if($.browser.version=='6.0'){css.position='absolute';$(window).scroll(function(){gethelp.css({'top':$(document).scrollTop()+180})})}gethelp.css(css);$("body").append(gethelp);gethelp.find('a.close').click(function(){$('.online_service').hide()});$(window).trigger("scroll")}};$(function(){})})(jQuery);(function($){var fnTimeCountDown=function(d,o){var f={zero:function(n){var n=parseInt(n,10);if(n>0){if(n<=9){n="0"+n}return String(n)}else{return"00"}},dv:function(){d=d||Date.UTC(2050,0,1);var future=new Date(d),now=new Date();var dur=Math.round((future.getTime()-now.getTime())/1000)+future.getTimezoneOffset()*60,pms={sec:"00",mini:"00",hour:"00",day:"00",month:"00",year:"0"};if(dur>0){pms.sec=f.zero(dur%60);pms.mini=Math.floor((dur/60))>0?f.zero(Math.floor((dur/60))%60):"00";pms.hour=Math.floor((dur/3600))>0?f.zero(Math.floor((dur/3600))%24):"00";pms.day=Math.floor((dur/86400))>0?f.zero(Math.floor((dur/86400))):"00";pms.month=Math.floor((dur/2629744))>0?f.zero(Math.floor((dur/2629744))%12):"00";pms.year=Math.floor((dur/31556926))>0?Math.floor((dur/31556926)):"0"}return pms},ui:function(){if(o.sec){o.sec.innerHTML=f.dv().sec+'秒'}if(o.mini){o.mini.innerHTML=f.dv().mini+'分'}if(o.hour){o.hour.innerHTML=f.dv().hour+'时'}if(o.day){o.day.innerHTML=f.dv().day+'天'}if(o.month){o.month.innerHTML=f.dv().month+'月'}if(o.year){o.year.innerHTML=f.dv().year+'年'}setTimeout(f.ui,1000)}};f.ui()};$(function(){$(".count_time_down").each(function(i){var endtime=$(this).text();if(endtime&&endtime!='undefined'){endtime=endtime.split('-');var endyear=endtime[0];var endmonth=endtime[1]-1;var endday=endtime[2];var endhour=endtime[3];var endmin=endtime[4];fnTimeCountDown(Date.UTC(endyear,endmonth,endday,endhour,endmin),{sec:$(".count_time_second").get(i),mini:$(".count_time_minute").get(i),hour:$(".count_time_hour").get(i),day:$(".count_time_day").get(i)})}})})})(jQuery);(function($){var favorite={'lock_flag':0,'add':function(id,$t){if(!hd.login.isLogin()){hd.login.showLogin();return false}if(favorite.lock_flag!==0)return false;favorite.lock_flag=1;$.post('./lifeajax.php?do=addFavorite',{'id':id},function(data){if(typeof data=='string')data=eval('('+data+')');if(data.status){$t.attr('_is_favorite',1);$t.html('<i class="ico20 heart"> </i>已收藏');var $shop_favorite_count=$t.siblings("span.dbcl").children("span.shop_favorite_count").eq(0),count=parseInt($shop_favorite_count.html());$shop_favorite_count.html(++count)}else{hd.dialog.alert(data.msg)}favorite.lock_flag=0})},'del':function(id,$t,cur_page){if(!hd.login.isLogin()){hd.login.showLogin();return false}if(favorite.lock_flag!==0)return false;favorite.lock_flag=1;$.post('./lifeajax.php?do=delFavorite',{'id':id},function(data){hd.dialog.close();if(typeof data=='string')data=eval('('+data+')');if(data.status){if(cur_page=='waterfall_list'){$t.attr('_is_favorite',0);$t.html('<i class="ico20 heart"> </i>收藏');var $shop_favorite_count=$t.siblings("span.dbcl").children("span.shop_favorite_count").eq(0),count=parseInt($shop_favorite_count.html());count=count>0?--count:0;$shop_favorite_count.html(count)}else{var url=window.location.href;hd.dialog.alert(data.msg,false,function(){top.location.href=url;return false})}}else{hd.dialog.alert(data.msg)}favorite.lock_flag=0})},'bindAddClick':function(){var $t=$(this),is_favorite=$t.attr('_is_favorite'),id=$t.attr('_id');if(is_favorite=='0'){favorite.add(id,$t)}else{favorite.del(id,$t,'waterfall_list')}},'bindDelClick':function(id,title){hd.dialog.confirm('','您确定要取消对 "'+title+'" 的关注？',function(){favorite.del(id)})}};$(".shop_waterfall_container").on('click.favorite','.shop_favorite_btn',favorite.bindAddClick);$(".shop_favorite_del_btn").click(function(){var id=$(this).attr('_id'),title=$("#favorite_goods_title_"+id).attr('title');favorite.bindDelClick(id,title)})})(jQuery);(function(){var instances=[],$win=$(window),scroll_top=0;hd.tools.waterfall=function(el,options,obj){if(!options.url||!options.tpl)return;var instance={element:el,active:true,loading:true,pn:1,max_pn:5};options.max_pn=parseInt(options.max_pn);if(!isNaN(options.max_pn))instance=$.extend(instance,{max_pn:options.max_pn});if(options.pn)instance=$.extend(instance,{pn:options.pn});instance.options=$.extend({selector:'.img_container'},options);instance.children=$(el).find(instance.options.selector);instance.cols=instance.children.length;instance.height=init_height(instance);instance.load_number=0;instance.overflow=0;instance.obj=obj?obj:{};var index=instances.length;instances[index]=instance;load(instance);return{setActive:function(val){instances[index].active=!!val}}};function get_min_key(s,v){for(k in s){if(s[k]==v){return k}}};function init_height(instance){var arr=[];for(var i=0;i<instance.cols;i++){arr[i]=instance.children.eq(i).height()}return arr}function img_append(instance,$item){instance.load_number++;var min_key='';if(instance.load_number>instance.overflow){min_key=instance.load_number-instance.overflow-1}else{min_key=get_min_key(instance.height,Math.min.apply(null,instance.height))}var $cur=instance.children.eq(min_key);$cur.append($item);instance.height[min_key]=parseInt($cur.height())}function load(instance){if(instance.pn>instance.max_pn){if('function'==typeof instance.obj.callFinish){instance.obj.callFinish(instance)}return}if(instance.pn>=2){if($win.scrollTop()<200){instance.loading=false;return}}if('function'==typeof instance.obj.beforeSend){instance.obj.beforeSend(instance)}$.getJSON(instance.options.url,{pn:instance.pn},function(data){if('function'==typeof instance.obj.success){instance.obj.success(data)}var data_len=data['count'];var data=data['data'];if(data_len){instance.overflow+=data_len-data_len%instance.cols;for(i in data){var item=data[i];var $item=$(instance.options.tpl.replace(/\{\w+\}/g,function(m){return item[m.substring(1,m.length-1)]}));(function($item,instance){var $img=$item.find('img').eq(0);if($img.length>0){$item.find('img').eq(0).load(function(){img_append(instance,$item)}).error(function(){img_append(instance,$item)})}else{img_append(instance,$item)}})($item,instance)}}if('function'==typeof instance.obj.complete){instance.obj.complete(instance)}if(instance.pn>instance.max_pn){if('function'==typeof instance.obj.callFinish){instance.obj.callFinish(instance)}return}setTimeout(function(){releaseLoading(instance)},100)});instance.pn++};function releaseLoading(instance){instance.loading=false}$win.scroll(function(){var temp_scroll_top=$win.scrollTop();if(temp_scroll_top>scroll_top&&($win.height()+temp_scroll_top)>=$("body").height()-100){scroll_top=temp_scroll_top;$.each(instances,function(i,instance){if(!instance.active||instance.loading)return;instance.loading=true;load(instance)})}})})();(function($){var $shop_waterfall_container=$("#shop_waterfall_container"),t=$shop_waterfall_container.attr('_t'),c=$shop_waterfall_container.attr('_c'),page=$shop_waterfall_container.attr('_page');var str_url='/lifeajax.php?do=getGoodsList',temp_t_url='',sub_user_name='{SubUserName}';if(page)str_url+='&page='+page;if(c)str_url+='&c='+c;if(t){str_url+='&t='+t;temp_t_url="&t="+t}var $shop_waterfall_title=$("#shop_waterfall_title"),size=$shop_waterfall_title.attr('_size');if(size){sub_user_name='{UserName}';str_url='/lifeajax.php?do=getGoodsRecommend&size='+size;var goods_id=$shop_waterfall_title.attr('_goods_id');if(str_url&&goods_id)str_url+='&goods_id='+goods_id}var tpl='<li>'+'<div class="im_bx">'+'<a target="_blank" title="{Title}" href="/lifeview.php?id={ShopTaoGoodsId}'+temp_t_url+'">'+'<img rel="nofollow" alt="{Title}" src="{PicUrl}">'+'<span class="price">￥{Price}</span>'+'</a>'+'</div>'+'<p class="fw_row">'+'<a class="fl btn_orange dbtn shop_favorite_btn" _id="{ShopTaoGoodsId}" _is_favorite="{IsFavorite}" href="javascript:///"><i class="ico20 heart">&nbsp;</i>{StrIsFavorite}</a>'+'<span class="fl dbcl"><i class="ico12 arr">&nbsp;</i><span class="shop_favorite_count">{FavoriteCount}</span></span>'+'</p>'+'<p class="fw_rowx">'+'<a target="_blank" title="{UserName}" href="http://wo.haodou.com/{UserId}/"><img alt="{UserName}" src="{AvatarUrl}"></a> '+'<a target="_blank" title="{UserName}" href="http://wo.haodou.com/{UserId}/">'+sub_user_name+'</a> '+'<span class="gray9">分享了此商品</span>'+'</p>'+'{ShareContent}'+'</li>';var waterfall_object='';function beforeSend(instance){$("#shop_waterfall_loading").show()}function success(data){for(var i in data.data){if(data.data[i].ShareContent){data.data[i].ShareContent='<q class="fw_row">'+data.data[i].ShareContent.toText()+'</q>'}if(data.data[i].Title){data.data[i].Title=data.data[i].Title.toText()}if(1===data.data[i].IsFavorite){data.data[i].StrIsFavorite='已收藏'}else{data.data[i].StrIsFavorite='收藏'}}if(data.count==0){waterfall_object.setActive(false);$("#shop_waterfall_page").show()}}function complete(instance){$("#shop_waterfall_loading").hide()}function callFinish(instance){$("#shop_waterfall_page").show()}if($shop_waterfall_container.length){waterfall_object=hd.tools.waterfall($shop_waterfall_container,{url:str_url,pn:2,tpl:tpl,selector:'.shop_waterfall_ul',max_pn:3},{beforeSend:beforeSend,success:success,complete:complete,callFinish:callFinish})}})(jQuery);
(function($){var index_slide={imgs:$('.slideRoll .picture_ul li'),overlays:$('.slideRoll .point_ul li'),count:null,cur:0,time:null,running:true,showPic:function(){index_slide.imgs.each(function(i){if(i==index_slide.cur)$(this).show();else $(this).hide()});index_slide.overlays.each(function(i){if(i==index_slide.cur){$(this).addClass('activ')}else{$(this).removeClass('activ')}});index_slide.cur++},go:function(){index_slide.count=index_slide.imgs.length;index_slide.showPic();index_slide.time=window.setInterval(function(){if(!index_slide.running)return true;if(index_slide.cur>=index_slide.count)index_slide.cur=0;index_slide.showPic()},5000)},pointer:function(x){index_slide.running=false;index_slide.cur=x;index_slide.showPic()},run:function(x){index_slide.running=true;index_slide.cur=x}};index_slide.go();index_slide.overlays.add(index_slide.imgs).hover(function(){index_slide.pointer($(this).index())},function(){index_slide.run($(this).index())});$('.slideRoll').hover(function(){index_slide.running=false},function(){index_slide.running=true})})(jQuery);